function feature_matrix = Extract_Features(data,opts)
% Extract Features and Create Feature Matrix
clc;
%%% Configurations
num_features = 243;
num_segments = size(data,1);
num_channels = size(data,2);
% segment_length = size(data,3);
feature_matrix = zeros(num_segments,num_channels,num_features);
% 1:num_segments
for i = 1:num_segments
    fprintf("Sample No.: %d\n",i);
    Current_Sample = squeeze(data(i,:,:));
    for ii = 1:num_channels
        Current_Sample_Channel = Current_Sample(:,ii);
        feature_matrix(i,ii,1) = jfmain('1d',Current_Sample_Channel);
        feature_matrix(i,ii,2) = jfmain('2d',Current_Sample_Channel);
        feature_matrix(i,ii,3) = jfmain('aac',Current_Sample_Channel);
        feature_matrix(i,ii,4) = jfmain('am',Current_Sample_Channel);
        feature_matrix(i,ii,5) = median(jfmain('ar',Current_Sample_Channel,opts),"all");
        feature_matrix(i,ii,6) = jfmain('aser',Current_Sample_Channel);
        feature_matrix(i,ii,7) = jfmain('aspr',Current_Sample_Channel);
        feature_matrix(i,ii,8) = jfmain('ave',Current_Sample_Channel);
        feature_matrix(i,ii,9) = jfmain('cov',Current_Sample_Channel);
        feature_matrix(i,ii,10) = jfmain('damv',Current_Sample_Channel);
        feature_matrix(i,ii,11) = jfmain('dasdv',Current_Sample_Channel);
        feature_matrix(i,ii,12:13) = jfmain('dff',Current_Sample_Channel,opts);
        feature_matrix(i,ii,14) = jfmain('dprac',Current_Sample_Channel,opts);
        feature_matrix(i,ii,15) = jfmain('dprbg',Current_Sample_Channel,opts);
        feature_matrix(i,ii,16) = jfmain('dprls',Current_Sample_Channel,opts);
        feature_matrix(i,ii,17) = jfmain('dprmt',Current_Sample_Channel,opts);
        feature_matrix(i,ii,18) = jfmain('dprpr',Current_Sample_Channel,opts);
        feature_matrix(i,ii,19) = jfmain('dprps',Current_Sample_Channel,opts);
        feature_matrix(i,ii,20) = jfmain('dprpy',Current_Sample_Channel,opts);
        feature_matrix(i,ii,21) = jfmain('dprwh',Current_Sample_Channel,opts);
        feature_matrix(i,ii,22) = jfmain('dvarv',Current_Sample_Channel);
        feature_matrix(i,ii,23) = jfmain('emav',Current_Sample_Channel);
        feature_matrix(i,ii,24) = jfmain('enap',Current_Sample_Channel,opts);
        feature_matrix(i,ii,25) = jfmain('enat',Current_Sample_Channel,opts);
        feature_matrix(i,ii,26) = jfmain('enbb',Current_Sample_Channel,opts);
        feature_matrix(i,ii,27:28) = jfmain('encd',Current_Sample_Channel,opts);
        feature_matrix(i,ii,29) = jfmain('encs',Current_Sample_Channel,opts);
        feature_matrix(i,ii,30:31) = jfmain('endp',Current_Sample_Channel,opts);
        feature_matrix(i,ii,32) = jfmain('enen',Current_Sample_Channel,opts);
        feature_matrix(i,ii,33) = jfmain('enfz',Current_Sample_Channel,opts);
        feature_matrix(i,ii,34:39) = jfmain('engd',Current_Sample_Channel,opts);
        feature_matrix(i,ii,40) = jfmain('enic',Current_Sample_Channel,opts);
        feature_matrix(i,ii,41:42) = jfmain('enk2',Current_Sample_Channel,opts);
        feature_matrix(i,ii,43) = jfmain('enle',Current_Sample_Channel);
        feature_matrix(i,ii,44) = jfmain('enph',Current_Sample_Channel,opts);
        feature_matrix(i,ii,45) = jfmain('enpm',Current_Sample_Channel,opts);
        feature_matrix(i,ii,46) = jfmain('enri',Current_Sample_Channel,opts);
        feature_matrix(i,ii,47) = jfmain('ensh',Current_Sample_Channel);
        feature_matrix(i,ii,48) = jfmain('ensm',Current_Sample_Channel,opts);
        feature_matrix(i,ii,49) = jfmain('ensd',Current_Sample_Channel,opts);
        feature_matrix(i,ii,50) = jfmain('ensl',Current_Sample_Channel,opts);
        feature_matrix(i,ii,51:52) = jfmain('ensp',Current_Sample_Channel,opts);
        feature_matrix(i,ii,53) = jfmain('ents',Current_Sample_Channel,opts);
        feature_matrix(i,ii,54:57) = jfmain('envf',Current_Sample_Channel,opts);
        feature_matrix(i,ii,58:83) = jfmain('enwv',Current_Sample_Channel,opts);
        feature_matrix(i,ii,84) = jfmain('ewl',Current_Sample_Channel);
        feature_matrix(i,ii,85) = jfmain('fzc',Current_Sample_Channel,opts);
        feature_matrix(i,ii,86) = jfmain('ha',Current_Sample_Channel);
        feature_matrix(i,ii,87) = jfmain('hc',Current_Sample_Channel);
        feature_matrix(i,ii,88) = jfmain('hm',Current_Sample_Channel);
        feature_matrix(i,ii,89) = jfmain('iqr',Current_Sample_Channel);
        feature_matrix(i,ii,90) = jfmain('kurt',Current_Sample_Channel);
        feature_matrix(i,ii,91) = jfmain('lcov',Current_Sample_Channel);
        feature_matrix(i,ii,92) = jfmain('ldamv',Current_Sample_Channel);
        feature_matrix(i,ii,93) = jfmain('ldasdv',Current_Sample_Channel);
        feature_matrix(i,ii,94) = jfmain('lrssv',Current_Sample_Channel);
        feature_matrix(i,ii,95) = jfmain('ltkeo',Current_Sample_Channel);
        feature_matrix(i,ii,96) = jfmain('mad',Current_Sample_Channel);
        feature_matrix(i,ii,97) = jfmain('mav',Current_Sample_Channel);
        feature_matrix(i,ii,98) = jfmain('max',Current_Sample_Channel);
        feature_matrix(i,ii,99) = jfmain('mcl',Current_Sample_Channel);
        feature_matrix(i,ii,100) = jfmain('md',Current_Sample_Channel);
        feature_matrix(i,ii,101) = jfmain('me',Current_Sample_Channel);
        feature_matrix(i,ii,102) = jfmain('mfl',Current_Sample_Channel);
        feature_matrix(i,ii,103) = jfmain('mmav',Current_Sample_Channel);
        feature_matrix(i,ii,104) = jfmain('mmav2',Current_Sample_Channel);
        feature_matrix(i,ii,105) = jfmain('mte',Current_Sample_Channel);
        feature_matrix(i,ii,106) = jfmain('n1d',Current_Sample_Channel);
        feature_matrix(i,ii,107) = jfmain('n2d',Current_Sample_Channel);
        feature_matrix(i,ii,108) = jfmain('ohmbg',Current_Sample_Channel,opts);
        feature_matrix(i,ii,109) = jfmain('ohmcv',Current_Sample_Channel,opts);
        feature_matrix(i,ii,110) = jfmain('ohmls',Current_Sample_Channel,opts);
        feature_matrix(i,ii,111) = jfmain('ohmmt',Current_Sample_Channel,opts);
        feature_matrix(i,ii,112) = jfmain('ohmpr',Current_Sample_Channel,opts);
        feature_matrix(i,ii,113) = jfmain('ohmps',Current_Sample_Channel,opts);
        feature_matrix(i,ii,114) = jfmain('ohmpy',Current_Sample_Channel,opts);
        feature_matrix(i,ii,115) = jfmain('ohmwh',Current_Sample_Channel,opts);
        feature_matrix(i,ii,116) = jfmain('p2p',Current_Sample_Channel);
        feature_matrix(i,ii,117) = jfmain('p2rms',Current_Sample_Channel);
        feature_matrix(i,ii,118:120) = jfmain('qtiles',Current_Sample_Channel);
        feature_matrix(i,ii,121) = jfmain('rms',Current_Sample_Channel);
        feature_matrix(i,ii,122) = jfmain('rssq',Current_Sample_Channel);
        feature_matrix(i,ii,123) = jfmain('sd',Current_Sample_Channel);
        feature_matrix(i,ii,124) = jfmain('skew',Current_Sample_Channel);
        feature_matrix(i,ii,125) = jfmain('ssc',Current_Sample_Channel);
        feature_matrix(i,ii,126) = jfmain('ssi',Current_Sample_Channel);
        feature_matrix(i,ii,127:238) = jfmain('ssf',Current_Sample_Channel,opts);
        feature_matrix(i,ii,239) = jfmain('tdd',Current_Sample_Channel);
        feature_matrix(i,ii,240) = jfmain('temm',Current_Sample_Channel);
        feature_matrix(i,ii,241) = jfmain('var',Current_Sample_Channel);
        feature_matrix(i,ii,242) = jfmain('vo',Current_Sample_Channel,opts);
        feature_matrix(i,ii,243) = jfmain('wl',Current_Sample_Channel);
    end
    feature_matrix = feature_matrix(:,:,1:243);
end
feature_matrix(isnan(feature_matrix)) = 0;
feature_matrix(isinf(feature_matrix)) = 0;
end